## Task 1
Creating and decoding secrets

```bash
$ kubectl create secret generic my-secret --from-literal=key1=val1 --from-literal=key2=val2
secret/my-secret created
```

```bash
$ kubectl get secrets
NAME                                       TYPE                 DATA   AGE
my-secret                                  Opaque               2      29s
sh.helm.release.v1.my-help-app-python.v1   helm.sh/release.v1   1      7d8h

$ kubectl describe secret my-secret
Name:         my-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
key1:  4 bytes
key2:  4 bytes

$ kubectl get secret my-secret -o jsonpath='{.data}'
{"key1":"dmFsMQ==","key2":"dmFsMg=="}

$ echo dmFsMQ== | base64 --decode
val1

$ echo dmFsMg== | base64 --decode
val2
```

Manage Secrets with Helm

```bash
$ sops -p $MY_FINGERPRINT helm-app-python/secrets.yaml # $MY_FINGERPRINT is from gpg --gen-key and `password: secret1234`
$ helm secrets install my-helm-app-python helm-app-python -f ./helm-app-python/secrets.yaml --values helm-app-python/values.yaml
```

```bash
$ kubectl get po
NAME                                  READY   STATUS    RESTARTS   AGE
my-helm-app-python-6d6884cdb7-dngnw   1/1     Running   0          76s

$ kubectl exec my-helm-app-python-6d6884cdb7-dngnw -- printenv | grep MY_PASSWORD
MY_PASSWORD=secret1234
$ 
```

## Task 2
```bash
$ kubectl get po
NAME                                   READY   STATUS    RESTARTS   AGE
my-helm-app-python-795b8c49c7-s7qdl    2/2     Running   0          48s
vault-0                                1/1     Running   0          24m
vault-agent-injector-dbfc5cd77-pb4mh   1/1     Running   0          24m

$ kubectl exec -it my-helm-app-python-795b8c49c7-s7qdl -- sh
Defaulted container "helm-app-python" out of: helm-app-python, vault-agent, vault-agent-init (init)

# Inside pod
/myapp $ cat /vault/secrets/database-config.txt
data: map[password:db-secret-password username:db-readonly-username]
metadata: map[created_time:2024-04-14T09:33:39.993151672Z custom_metadata:<nil> deletion_time: destroyed:false version:1]

/myapp $ df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                  58.4G     19.4G     36.0G  35% /
tmpfs                    64.0M         0     64.0M   0% /dev
tmpfs                     7.6G      4.0K      7.6G   0% /vault/secrets
/dev/vda1                58.4G     19.4G     36.0G  35% /dev/termination-log
/dev/vda1                58.4G     19.4G     36.0G  35% /etc/resolv.conf
/dev/vda1                58.4G     19.4G     36.0G  35% /etc/hostname
/dev/vda1                58.4G     19.4G     36.0G  35% /etc/hosts
shm                      64.0M         0     64.0M   0% /dev/shm
tmpfs                     7.6G     12.0K      7.6G   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                     3.8G         0      3.8G   0% /sys/firmware
```
